import { Toolbox, Rest } from 'bdt105toolbox/dist';
import { Vidal } from './vidal';

var r = new Rest();

var body = "<?xml version=\'1.0\' encoding=\'UTF-8\' standalone=\'yes\'?><prescription><patient><dateOfBirth>1980-12-25T00:00:00</dateOfBirth><gender>FEMALE</gender><weight>55</weight><height>111</height><breastFeeding>NONE</breastFeeding><hepaticInsufficiency>NONE</hepaticInsufficiency><allergies><allergy>vidal://allergy/729</allergy></allergies><molecules><molecule>vidal://molecule/420</molecule><molecule>vidal://molecule/3295</molecule></molecules><pathologies><pathology>vidal://cim10/2720</pathology><pathology>vidal://cim10/2668</pathology><pathology>vidal://cim10/2640</pathology></pathologies></patient><prescription-lines><prescription-line><drug>vidal://vmp/2508</drug><dose>1</dose><unitId>129</unitId><duration>1</duration><durationType>MONTH</durationType><frequencyType>PER_DAY</frequencyType><routes><route>vidal://route/38</route></routes></prescription-line><prescription-line><drug>vidal://vmp/2675</drug><dose>1</dose><unitId>60</unitId><duration>1</duration><durationType>MONTH</durationType><frequencyType>PER_DAY</frequencyType><routes><route>vidal://route/38</route></routes></prescription-line><prescription-line><drug>vidal://product/15070</drug><dose>1</dose><unitId>129</unitId><duration>1</duration><durationType>MONTH</durationType><frequencyType>PER_DAY</frequencyType><routes><route>vidal://route/38</route></routes></prescription-line><prescription-line><drug>vidal://vmp/1533</drug><dose>12</dose><unitId>129</unitId><duration>1</duration><durationType>MONTH</durationType><frequencyType>PER_DAY</frequencyType><routes><route>vidal://route/38</route></routes></prescription-line><prescription-line><drug>vidal://product/4882</drug><dose>1</dose><unitId>129</unitId><duration>1</duration><durationType>MONTH</durationType><frequencyType>PER_DAY</frequencyType><routes><route>vidal://route/38</route></routes></prescription-line><prescription-line><drug>vidal://product/4002</drug><dose>1</dose><unitId>129</unitId><duration>1</duration><durationType>MONTH</durationType><frequencyType>PER_DAY</frequencyType><routes><route>vidal://route/38</route></routes></prescription-line></prescription-lines></prescription>";

let callback = function(json: any){
    console.log(JSON.stringify(json));
}

//r.call(data => callback(data), "GET", "http://api.vidal.fr/rest/api/version", null, "text/xml");
//r.call(data => callback(data), "POST", "http://api.vidal.fr/rest/api/alerts/full?app_id=&app_key=", body, "text/xml");

var v = new Vidal();
var presc = '{"idprescription":"128","idpatient":"459","user":"bernard.deregnaucourt@vidal.fr","creationDate":"2017-10-25 07:10:48","updateDate":"2017-10-25 07:10:48","__tableName":"SELECT * FROM prescription WHERE idprescription=\'128\' LIMIT 15 OFFSET 0","patient":{"idpatient":"459","dateOfBirth":"1980-12-25 00:00:00","gender":"FEMALE","weight":"55","height":"111","weeksOfAmenorrhea":null,"breastFeeding":"NONE","creatin":null,"hepaticInsufficiency":"NONE","user":"bernard.deregnaucourt@vidal.fr","name":"Patiente","allergyIds":"729","moleculeIds":"420|3295","cim10Ids":"2720|2668|2640","firstName":"Amélie","record":"","text":"","cim10Codes":"F51.0|F41.1|F32.9","__tableName":"SELECT * FROM patient WHERE idpatient=\'459\' LIMIT 15 OFFSET 0"},"lines":[{"idprescriptionline":"277","idprescription":"128","productId":"2508","productCode":null,"productName":"SULBUTIAMINE 200 mg cp","productDetail":"sulbutiamine * 200 mg ; voie orale ; cp","unitId":"129","unitName":"comprimé","productType":"vmp","durationType":"MONTH","frequencyType":"PER_DAY","dose":"1","duration":"1","routeId":"38","routeName":"orale","galenicFormId":"59","galenicFormName":"comprimé","summary":"1 comprimé (orale) par jour pendant 1 mois","indicationIds":"","moments":null,"days":null,"onDemand":null,"comment":"","momentDoses":null,"atcClass":"A11DA02","vidalClass":null,"__tableName":"SELECT * FROM prescriptionline WHERE idprescription=\'128\' LIMIT 15 OFFSET 0"},{"idprescriptionline":"275","idprescription":"128","productId":"2675","productCode":null,"productName":"ACIDE CLAVULANIQUE (sel de k) 12,5 mg/ml + AMOXICILLINE 100 mg/ml pdre p susp buv","productDetail":"acide clavulanique (sel de K) * 12,5 mg/ml + amoxicilline * 100 mg/ml ; voie orale ; pdre p susp buv","unitId":"60","unitName":"millilitre","productType":"vmp","durationType":"MONTH","frequencyType":"PER_DAY","dose":"1","duration":"1","routeId":"38","routeName":"orale","galenicFormId":"422","galenicFormName":"poudre pour suspension buvable","summary":"1 millilitre (orale) par jour pendant 1 mois","indicationIds":"","moments":null,"days":null,"onDemand":null,"comment":null,"momentDoses":null,"atcClass":"J01CR02","vidalClass":null,"__tableName":"SELECT * FROM prescriptionline WHERE idprescription=\'128\' LIMIT 15 OFFSET 0"},{"idprescriptionline":"272","idprescription":"128","productId":"15070","productCode":null,"productName":"SINTROM 4 mg cp quadriséc","productDetail":"ACENOCOUMAROL 4 mg cp (SINTROM)","unitId":"129","unitName":"comprimé","productType":"product","durationType":"MONTH","frequencyType":"PER_DAY","dose":"1","duration":"1","routeId":"38","routeName":"orale","galenicFormId":"135","galenicFormName":"comprimé quadrisécable","summary":"1 comprimé (orale) par jour pendant 1 mois","indicationIds":"","moments":null,"days":null,"onDemand":null,"comment":null,"momentDoses":null,"atcClass":"B01AA07","vidalClass":"3762","__tableName":"SELECT * FROM prescriptionline WHERE idprescription=\'128\' LIMIT 15 OFFSET 0"},{"idprescriptionline":"273","idprescription":"128","productId":"1533","productCode":null,"productName":"BISOPROLOL HEMIFUMARATE 1,25 mg cp","productDetail":"bisoprolol hémifumarate * 1,25 mg ; voie orale ; cp","unitId":"129","unitName":"comprimé","productType":"vmp","durationType":"MONTH","frequencyType":"PER_DAY","dose":"12","duration":"1","routeId":"38","routeName":"orale","galenicFormId":"59","galenicFormName":"comprimé","summary":"12 comprimé (orale) par jour pendant 1 mois","indicationIds":"","moments":null,"days":null,"onDemand":null,"comment":null,"momentDoses":null,"atcClass":"C07AB07","vidalClass":null,"__tableName":"SELECT * FROM prescriptionline WHERE idprescription=\'128\' LIMIT 15 OFFSET 0"},{"idprescriptionline":"280","idprescription":"128","productId":"4882","productCode":null,"productName":"DEPAKINE 200 mg cp gastrorésis","productDetail":"VALPROATE DE SODIUM 200 mg cp gastrorésis (DEPAKINE)","unitId":"129","unitName":"comprimé","productType":"product","durationType":"MONTH","frequencyType":"PER_DAY","dose":"1","duration":"1","routeId":"38","routeName":"orale","galenicFormId":"106","galenicFormName":"comprimé gastrorésistant","summary":"1 comprimé (orale) par jour pendant 1 mois","indicationIds":"","moments":null,"days":null,"onDemand":null,"comment":null,"momentDoses":null,"atcClass":"N03AG01","vidalClass":"3087","__tableName":"SELECT * FROM prescriptionline WHERE idprescription=\'128\' LIMIT 15 OFFSET 0"},{"idprescriptionline":"288","idprescription":"128","productId":"4002","productCode":null,"productName":"CLAMOXYL 1 g cp dispers","productDetail":"AMOXICILLINE 1 g cp dispers (CLAMOXYL)","unitId":"129","unitName":"comprimé","productType":"product","durationType":"MONTH","frequencyType":"PER_DAY","dose":"1","duration":"1","routeId":"38","routeName":"orale","galenicFormId":"79","galenicFormName":"comprimé dispersible","summary":"1 comprimé (orale) par jour pendant 1 mois","indicationIds":"","moments":null,"days":null,"onDemand":null,"comment":null,"momentDoses":null,"atcClass":"J01CA04","vidalClass":"1366","__tableName":"SELECT * FROM prescriptionline WHERE idprescription=\'128\' LIMIT 15 OFFSET 0"}]}';
var pre = JSON.parse(presc);
var params = {};
v.getAlerts(callback, pre, params, "xml");