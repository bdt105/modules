!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@angular/core"),require("bdt105angulardatabaseservice"),require("bdt105toolbox/dist"),require("bdt105vidal/dist")):"function"==typeof define&&define.amd?define(["exports","@angular/core","bdt105angulardatabaseservice","bdt105toolbox/dist","bdt105vidal/dist"],n):n((e.ng=e.ng||{},e.ng.bdt105angularconnexionservice={}),e.ng.core,e.bdt105angulardatabaseservice,e.dist,e.dist$1)}(this,function(e,n,t,o,i){"use strict";var r=function(){function e(e){this.databaseService=e,this.tableName="user",this.toolbox=new o.Toolbox,this.vidal=new i.Vidal("dbd540aa","8343650ea233a4716f524ab77dc24948"),this.disconnect=function(){return this.toolbox.removeFromStorage("connexion"),this.connexion=null,!0},this.getConnexion=function(){var e=this.toolbox.readFromStorage("connexion");return"object"==typeof e?(this.connexion=e,this.connexion):null}}return e.prototype.connectFake=function(){var e=function(){};this.connect(e,e,"chlux","chlux",!0)},e.prototype.connect=function(e,n,t,o,i){var r=this;this.databaseService.login=t,this.databaseService.password=o;var s={__where:"email='"+t+"' AND password='"+o+"'"};this.databaseService.read(function(n){return r.success(e,i,n)},function(s){return r.failure(e,n,t,o,i,s)},this.tableName,s)},e.prototype.changeCurrentUserLang=function(e){this.connexion&&this.connexion.currentUser&&(this.connexion.currentUser.lang=e,this.toolbox.writeToStorage("connexion",this.connexion,!1))},e.prototype.success=function(e,n,t){var o=t.json.results[0];o.login=o.email,this.connexion={currentUser:o},this.toolbox.writeToStorage("connexion",this.connexion,n),null!==e&&e(this.connexion)},e.prototype.successAfterLogin=function(e,n,t,o,i){var r={login:n,password:t};this.connexion={currentUser:r},this.toolbox.writeToStorage("connexion",this.connexion,o),null!==e&&e(this.connexion)},e.prototype.callbackAfterAfterLogin=function(e,n,t,o,i,r){this.connexion={currentUser:{login:"editeurs@vidal.fr",password:"editeurs",lang:"FR",country:"FR"}},this.toolbox.writeToStorage("connexion",this.connexion,r),null!==t&&t(this.connexion)},e.prototype.failureAfterAfterLogin=function(e,n){this.disconnect(),null!==n&&n(e)},e.prototype.failureAfterLogin=function(e,n,t,o,i,r){var s=this;this.vidal.getVersion(function(r,a){return function(r,a){r&&s.callbackAfterAfterLogin(r,a,e,t,o,i),a&&s.failureAfterAfterLogin(r,n)}(r,a)},[],"app_id="+t+"&app_key="+o)},e.prototype.failure=function(e,n,t,o,i,r){this.failureAfterLogin(e,n,t,o,i,r)},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[{type:t.DatabaseService}]},e}();e.ConnexionService=r,Object.defineProperty(e,"__esModule",{value:!0})});